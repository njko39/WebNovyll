<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }}</title>
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/styles.css">
</head>


<body>

    <div class="game-screen">
        <div class="background"
            style="background: url('{{ site.baseurl }}/assets/backgrounds/{{ page.background }}') center/cover no-repeat;"></div>

        <div class="character-portrait">
            <img src="{{ site.baseurl }}/assets/characters/test1.png" alt="–ì–ª–∞–≤–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂">
        </div>

        <div class="dialogue-box">
            <div class="character-name">Loading...</div>
            <div class="dialogue-content">
                <p id="current-dialogue"><!-- –î–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript --></p>
            </div>

            <div class="button-panel">
                <button id="next-btn">Next</button>
                <button id="log-btn">üìú Log</button>
                <a href="{{ site.baseurl }}/">
                    <button>Menu</button>
                </a>
            </div>
        </div>
    </div>

    <!-- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ª–æ–≥–∞ -->
    {% comment %}
    –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∏–∑ –ø–∞–ø–∫–∏ "story/"
    {% endcomment %}
    {% assign story_pages = site.pages | where_exp: "page", "page.path contains 'story/'" %}

    {% if story_pages != empty %}
    {% assign sorted_pages = story_pages | sort: "path" %}
    {% assign sorted_paths = "" %}

    {% for p in sorted_pages %}
    {% assign sorted_paths = sorted_paths | append: p.path | append: "," %}
    {% endfor %}

    {% assign sorted_paths_array = sorted_paths | split: "," %}
    {% assign current_index = -1 %}

    {% for path in sorted_paths_array %}
    {% if path == page.path %}
    {% assign current_index = forloop.index0 %}
    {% endif %}
    {% endfor %}

    {% assign last_index = sorted_paths_array.size | minus: 1 %}

    {% if current_index != -1 and current_index < last_index %} {% assign next_index=current_index | plus: 1 %} {%
        assign next_page=sorted_pages[next_index] %} {% endif %} {% comment %} –°–æ–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 –¥–∏–∞–ª–æ–≥–æ–≤ {%
        endcomment %} {% assign log_entries="" %} {% assign start_index=current_index | minus: 50 %} {% if start_index <
        0 %} {% assign start_index=0 %} {% endif %} {% assign file_counter=1 %} {% for index in
        (start_index..current_index) reversed %} {% assign log_page=sorted_pages[index] %} {% if log_page %} {% assign
        log_entries=log_entries | append: "===== –§–∞–π–ª " | append: file_counter | append: " –Ω–∞—á–∞–ª–æ =====\n" |
        append: "–°—Å—ã–ª–∫–∞: /" | append: log_page.path | append: "\n\n" | append: log_page.content | append: "===== –§–∞–π–ª "
        | append: file_counter | append: " –∫–æ–Ω–µ—Ü =====\n\n" %} {% assign file_counter=file_counter | plus: 1 %} {% endif
        %} {% endfor %} {% endif %} <div id="raw-log-content" style="display: none;">{{ log_entries }}</div>

        <!-- –ö–Ω–æ–ø–∫–∞ "Debug" –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É -->
        <button id="debug-btn">üõ† Debug</button>

        <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ Debug -->
        <div id="debug-modal">
            <div id="debug-content">
                <h2>Debug Info</h2>
                <pre id="debug-text"></pre>
                <button id="copy-btn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button id="close-btn">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ Log -->
        <div id="log-modal">
            <div id="log-content">
                <h2>Dialogue Log</h2>
                <div id="log-text" class="log-text"><!-- –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–æ–≥ --></div>
                <button id="log-close-btn">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∞ -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                let rawLogContent = document.getElementById("raw-log-content").innerText;
        
                // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Ñ–∞–π–ª—ã, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –∑–∞–≥–æ–ª–æ–≤–∫–∏ "–§–∞–π–ª X –Ω–∞—á–∞–ª–æ"
                let fileSections = rawLogContent.split(/===== –§–∞–π–ª \d+ –Ω–∞—á–∞–ª–æ =====/).slice(1);
                let formattedLog = fileSections.map(formatSection).join(" ");
        
                // –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –æ—Ç –º—É—Å–æ—Ä–∞
                formattedLog = cleanUpText(formattedLog);
        
                // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Ä–µ–ø–ª–∏–∫–∏ –≤ <p>
                formattedLog = wrapReplicasWithParagraphs(formattedLog);
        
                // –î–æ–±–∞–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç storypage_url –∫–æ –≤—Å–µ–º <p>
                formattedLog = addStoryPageUrl(formattedLog);
        
                // –í—ã–≤–æ–¥–∏–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                updateLog(formattedLog);
        
                // –°–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º URL
                window.addEventListener("popstate", () => updateLog(formattedLog));
            });
        
            function formatSection(section) {
                let idCounter = 0;
        
                // –ò–∑–≤–ª–µ–∫–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª –∏ —É–¥–∞–ª—è–µ–º –µ—ë –∏–∑ —Å–µ–∫—Ü–∏–∏
                let fileLink = (section.match(/–°—Å—ã–ª–∫–∞: (\/story\/[\d-]+)\.md/) || [])[1];
                section = section.replace(/–°—Å—ã–ª–∫–∞: \/story\/[\d-]+\.md/, "").trim();
        
                // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Ä–µ–ø–ª–∏–∫–∏, —Å–æ—Ö—Ä–∞–Ω—è—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
                let parts = section.split(/(\[\/ )/g);
                let structuredParts = [];
                let buffer = "";
                let capturing = false;
        
                for (let part of parts) {
                    if (part === "[/ ") {
                        if (buffer) structuredParts.push(buffer);
                        buffer = `[/ id="${idCounter++}" `;
                        capturing = true;
                    } else if (capturing && part.includes("[/end]")) {
                        buffer += part;
                        structuredParts.push(buffer);
                        buffer = "";
                        capturing = false;
                    } else {
                        buffer += part;
                    }
                }
                if (buffer) structuredParts.push(buffer);
        
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–ø–ª–∏–∫–∏
                return structuredParts
                    .reverse()
                    .map(replica =>
                        replica
                            .replace(/img=[‚Äô'][^‚Äô']*[‚Äô']\s?/g, "") // –£–¥–∞–ª—è–µ–º img
                            .replace(/\s{2,}/g, " ") // –£–±–∏—Ä–∞–µ–º –¥–≤–æ–π–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
                            .replace(/\[\/ id="(\d+)" char=[‚Äô']([^‚Äô']*)[‚Äô'] \]/g, "<p storypage_id='$1'>$2</p>") // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ <p>
                            .replace(/\[\/end\]/g, "") // –£–±–∏—Ä–∞–µ–º [/end]
                            .trim()
                    )
                    .join(" ") // –°–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç –æ–±—Ä–∞—Ç–Ω–æ
                    .replace(/<p storypage_id='(\d+)'>\s*([^<]+)\s*<\/p>/g, (match, storyId, charName) =>
                        fileLink ? `<p storypage_id='${storyId}'><a href='{{ site.baseurl }}${fileLink}?id=${storyId}'>${charName}</a></p>` : match
                    );
            }
        
            function cleanUpText(text) {
                return text
                    .replace(/===== –§–∞–π–ª \d+ –∫–æ–Ω–µ—Ü =====/g, "") // –£–±–∏—Ä–∞–µ–º "–§–∞–π–ª X –∫–æ–Ω–µ—Ü"
                    .replace(/\s+/g, " ") // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
                    .replace(/\n+/g, " ") // –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                    .replace(/\\n+/g, " ") // –£–±–∏—Ä–∞–µ–º –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ \n
                    .trim();
            }
        
            function getCurrentIdFromUrl() {
                let params = new URLSearchParams(window.location.search);
                return parseInt(params.get("id"), 10) || Infinity;
            }
        
            function updateLog(fullLog) {
                let maxId = getCurrentIdFromUrl();
        
                // –§–∏–ª—å—Ç—Ä—É–µ–º —Ä–µ–ø–ª–∏–∫–∏, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ —Ç–µ, —É –∫–æ—Ç–æ—Ä—ã—Ö storypage_id ‚â§ maxId
                let filteredLog = fullLog.replace(/<p storypage_id='(\d+)'>\s*([^<]+)\s*<\/p>/g, (match, id, content) => {
                    return parseInt(id, 10) <= maxId ? match : "";
                });
        
                document.getElementById("log-text").innerHTML = filteredLog;
            }
        
            function wrapReplicasWithParagraphs(logContent) {
                return logContent.replace(/(<p storypage_id='(\d+)'>.*?<\/p>)\s*([^<]+)/g, 
                    (match, nameTag, storyId, replica) => `${nameTag} <p storypage_id='${storyId}'>${replica.trim()}</p>`);
            }
        
            function addStoryPageUrl(logContent) {
                let lastUrl = "";
        
                return logContent.replace(/<p storypage_id='(\d+)'>\s*(<a href='([^']+)'>[^<]+<\/a>)?\s*([^<]*)<\/p>/g, 
                    (match, storyId, linkTag, url, content) => {
                        if (url) lastUrl = url; // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É, –µ—Å–ª–∏ –Ω–∞—à–ª–∏
                        return `<p storypage_id='${storyId}' storypage_url='${lastUrl}'>${linkTag ? linkTag : content}</p>`;
                    });
            }
        </script>
        
        
        

        <div id="raw-content" style="display: none;">{{ content }}</div>

        <!-- JavaScript -->

        <script>
            // –ü–æ—è–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞
            window.addEventListener("load", function () {
                document.querySelector(".background").style.opacity = "1";
            });

            // –û—Ç–∫—Ä—ã—Ç–∏–µ Debug –æ–∫–Ω–∞
            document.getElementById("debug-btn").addEventListener("click", function () {
                document.getElementById("debug-modal").style.display = "block";
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ Debug –æ–∫–Ω–∞
            document.getElementById("close-btn").addEventListener("click", function () {
                document.getElementById("debug-modal").style.display = "none";
            });

            // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ Debug Info –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            document.getElementById("copy-btn").addEventListener("click", function () {
                const text = document.getElementById("debug-text").innerText;
                navigator.clipboard.writeText(text).then(() => {
                    alert("Debug Info —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
                });
            });

            // –û—Ç–∫—Ä—ã—Ç–∏–µ Log –æ–∫–Ω–∞
            document.getElementById("log-btn").addEventListener("click", function () {
                document.getElementById("log-modal").style.display = "block";
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ Log –æ–∫–Ω–∞
            document.getElementById("log-close-btn").addEventListener("click", function () {
                document.getElementById("log-modal").style.display = "none";
            });

            document.addEventListener("DOMContentLoaded", function () {
    console.log("üöÄ –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω!");

    let rawContent = document.getElementById("raw-content");
    if (!rawContent) {
        console.error("‚ùå –û—à–∏–±–∫–∞: <div id='raw-content'> –Ω–µ –Ω–∞–π–¥–µ–Ω!");
        return;
    }

    let text = rawContent.innerText.trim();
    console.log("üìú –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç (–∏–∑ raw-content):", text);

    if (!text) {
        console.error("‚ùå –û—à–∏–±–∫–∞: raw-content –ø—É—Å—Ç–æ–π!");
        return;
    }

    let regex = /\[\/\s*char=[‚Äò‚Äô"']([^‚Äò‚Äô"']+)[‚Äò‚Äô"']\s*img=[‚Äò‚Äô"']([^‚Äò‚Äô"']+)[‚Äò‚Äô"']\s*\]([\s\S]*?)\[\/end\s*\]/g;
    let story_content = [];
    let match;
    let currentDialogueIndex = 0;
    let isTyping = false;
    let typingTimeouts = [];
    let audio = new Audio("{{ site.baseurl }}/assets/sounds/typing.mp3");

    console.log("üîç –ù–∞—á–∏–Ω–∞–µ–º —Ä–∞–∑–±–æ—Ä —Ç–µ–∫—Å—Ç–∞...");

    while ((match = regex.exec(text)) !== null) {
        console.log("üõ† –ù–∞–π–¥–µ–Ω –±–ª–æ–∫:", match);
        story_content.push({ char: match[1].trim(), img: match[2].trim(), dialogue: match[3].trim() });
    }

    console.log("üìñ –ò—Ç–æ–≥–æ–≤—ã–π –º–∞—Å—Å–∏–≤ story_content:", story_content);

    function getDialogueIdFromUrl() {
        let params = new URLSearchParams(window.location.search);
        let id = parseInt(params.get("id"), 10);
        return isNaN(id) ? 0 : id;
    }

    currentDialogueIndex = getDialogueIdFromUrl();
    if (currentDialogueIndex >= story_content.length) {
        currentDialogueIndex = 0;
    }
    updateDialogue();

    function updateDialogue() {
        let dialogueData = story_content[currentDialogueIndex];

        let charNameElement = document.querySelector(".character-name");
        if (charNameElement) charNameElement.textContent = dialogueData.char;

        let charImageElement = document.querySelector(".character-portrait img");
        if (charImageElement) charImageElement.src = `{{ site.baseurl }}/assets/characters/${dialogueData.img}`;

        let dialogueElement = document.getElementById("current-dialogue");
        if (dialogueElement) typeText(dialogueElement, dialogueData.dialogue);

        history.pushState(null, "", `?id=${currentDialogueIndex}`);

        let nextButton = document.getElementById("next-btn");
        if (nextButton) {
            if (currentDialogueIndex >= story_content.length - 1) {
                nextButton.outerHTML = `<a href="{{ site.baseurl }}{{ next_page.url }}"><button id="next-btn">Next</button></a>`;
            }
        }
    }

    let nextButton = document.getElementById("next-btn");
    if (nextButton) {
        nextButton.addEventListener("click", function () {
    let dialogueElement = document.getElementById("current-dialogue");

    console.log("–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ Next. isTyping:", isTyping);

    // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –µ—â—ë –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç
    if (isTyping) {
        console.log("–¢–µ–∫—Å—Ç –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è. –ü—Ä–µ—Ä—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é.");
        typingTimeouts.forEach(clearTimeout); // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–∞–π–º–µ—Ä—ã –ø–µ—á–∞—Ç–∏
        typingTimeouts = [];
        isTyping = false;
        dialogueElement.textContent = story_content[currentDialogueIndex].dialogue;
        return;
    }

    // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —É–∂–µ –≤—ã–≤–µ–¥–µ–Ω ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ª–æ–≥–∏–∫—É
    if (currentDialogueIndex < story_content.length - 1) {
        console.log("–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–∏–∞–ª–æ–≥—É.");
        currentDialogueIndex++;
        updateDialogue();
    } else {
        console.log("–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.");
        window.location.href = "{{ site.baseurl }}{{ next_page.url }}";
    }
});


    }

    document.body.addEventListener("click", function (event) {
        let dialogueElement = document.getElementById("current-dialogue");
        if (!dialogueElement) return;

        if (event.target.closest(".dialogue-content") && isTyping) {
            typingTimeouts.forEach(clearTimeout);
            typingTimeouts = [];
            isTyping = false;
            dialogueElement.textContent = story_content[currentDialogueIndex].dialogue;
        }
    });

    function typeText(element, text, speed = 50) {
        element.textContent = "";
        let i = 0;
        isTyping = true;

        function printLetter() {
            if (i < text.length) {
                element.textContent += text[i];
                if (text[i] !== " " && audio.readyState >= 2) {
                    audio.currentTime = 0;
                    audio.volume = 0.08; // (–∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç 0 –¥–æ 1)

                    audio.play().catch(err => console.warn("üîá –ó–≤—É–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±—Ä–∞—É–∑–µ—Ä–æ–º", err));
                }
                typingTimeouts.push(setTimeout(printLetter, speed));
                i++;
            } else {
                isTyping = false;
            }
        }
        printLetter();
    }
});





        </script>

<script>
    //–°–∫—Ä–∏–ø—Ç —Å–∫—Ä—ã—Ç–∏—è —Å–ø–æ–π–ª–µ—Ä–æ–≤ –∏–∑ –ª–æ–≥–∞
    document.addEventListener("DOMContentLoaded", function () {
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        hideMatchingParagraphs();

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ Next
        document.getElementById("next-btn").addEventListener("click", function () {
            incrementIdAndRescan();
        });
    });

    function hideMatchingParagraphs() {
        let currentPage = getCurrentPageWithoutHtml();
        let paragraphs = Array.from(document.querySelectorAll("#log-text p"));
        let matchIndex = -1; // –ò–Ω–¥–µ–∫—Å –ø–µ—Ä–≤–æ–≥–æ —Å–æ–≤–ø–∞–≤—à–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞

        console.log("=== –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫—Ä—ã—Ç–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ ===");
        console.log("–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è):", currentPage);

        // –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –ø–µ—Ä–≤–æ–≥–æ —Å–æ–≤–ø–∞–¥–∞—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        paragraphs.forEach((p, index) => {
            let storyUrl = (p.getAttribute("storypage_url") || "").trim();
            let storyFullUrl = storyUrl.replace(".html", ""); // –£–±–∏—Ä–∞–µ–º ".html" –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–∞, –µ—Å–ª–∏ –µ—Å—Ç—å

            console.log("–ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–ª–µ–º–µ–Ω—Ç:", p);
            console.log(" ‚Üí storypage_url:", storyUrl);
            console.log(" ‚Üí storyFullUrl (–±–µ–∑ .html):", storyFullUrl);

            if (storyFullUrl === currentPage && matchIndex === -1) {
                matchIndex = index;
                console.log("‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø–µ—Ä–≤–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ! –û—Å—Ç–∞–≤–ª—è–µ–º –≤—Å—ë –ø–æ—Å–ª–µ –Ω–µ–≥–æ –≤–∏–¥–∏–º—ã–º.");
            }
        });

        // –¢–µ–ø–µ—Ä—å —Å–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã—à–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ
        paragraphs.forEach((p, index) => {
            if (index < matchIndex) {
                console.log("üõë –°–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç!", p);
                p.style.display = "none";
            } else {
                console.log("‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∏–º—ã–º", p);
                p.style.display = "";
            }
        });

        console.log("=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ===");
    }

    function incrementIdAndRescan() {
        let currentPage = getCurrentPageWithoutHtml();

        // –ò–∑–≤–ª–µ–∫–∞–µ–º id –∏–∑ currentPage
        let match = currentPage.match(/id=(\d+)/);
        if (match) {
            let currentId = parseInt(match[1], 10);
            let newId = currentId + 1;

            // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π currentPage —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º id
            let newPage = currentPage.replace(/id=\d+/, `id=${newId}`);
            console.log("üîÑ –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º id:", currentPage, "‚Üí", newPage);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Å–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
            document.querySelectorAll("#log-text p").forEach(p => p.style.display = "");

            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–Ω–æ–≤–æ
            hideMatchingParagraphs();
        }
    }

    function getCurrentPageWithoutHtml() {
        let currentUrl = new URL(window.location.href);
        let currentPath = currentUrl.pathname; // "/story/1-0.html" –∏–ª–∏ "/story/1-0"
        let currentId = currentUrl.searchParams.get("id") || ""; // "0"

        // –£–¥–∞–ª—è–µ–º ".html", –µ—Å–ª–∏ –µ—Å—Ç—å
        if (currentPath.endsWith(".html")) {
            currentPath = currentPath.replace(".html", "");
        }

        return `${currentPath}?id=${currentId}`;
    }
</script>









</body>

</html>